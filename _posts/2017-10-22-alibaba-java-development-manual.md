---
layout: post
title: "阿里巴巴 java 开发手册"
date: "2017-10-22"
description: "阿里巴巴 java 开发手册"
tag: [java,p3c]
---

10月14日上午9:00 阿里巴巴于在杭州云栖大会上, 正式发布<<阿里巴巴Java开发手册>>扫描插件, 该插件在扫描代码后, 将不符合约定的代码按Blocker/Critical/Major三个等级显示在下方。  

### 开发手册
以下是结合自己实际编程经验所认可或推荐的规约, 仍有部分不懂的或没用到的地方, 后续逐步更新  
`标记`: 暂时未遇到相似场景或不知如何处理比较好
#### **1 编程规约**
#### 1.1 命名风格
- [强制] 代码中命名均不能以下划线或美元符号开始或结束
- [强制] 代码中命名严禁使用拼音, 一律使用英文
- [强制] 类名使用UpperCamelCase风格, `通用简写`
- [强制] 方法名, 参数名, 成员变量, 局部变量统一使用lowerCamelCase风格
- [强制] 常量命名全大写, 单词间用下划线间隔, 力求语义完整, 不要嫌命名长
- [强制] 抽象类命名使用Abstract开头; 异常类命名使用Exception结尾; 测试类以要测试的类名称开始, 以Test结尾
- [强制] 中括号是数组类型的一部分, 数组定义如下: String[] args;
- [强制] POJO类中的布尔类型变量都不以is开头, 否则部分框架解析会引起序列化错误
- [强制] 包名统一使用小写, 点分隔符之间有且仅有一个自然语义的英文单词; 包名统一使用单数形式, 类名如果有复数含义可用复数形式
- [强制] 杜绝完全不规范和不通用缩写, 不要嫌命名长, 避免望文不知义
- [推荐] 为使代码有自解释性, 命名时尽量使用完整单词组合
- [推荐] 接口类的方法和属性不要加任何修饰符号, 只加上有效注释保持代码简洁;`接口中定义变量`
- 接口和实现类的命名规则
  - [强制] 对于Service和Dao接口, 实现类用Impl后缀区别
  - [推荐] 形如能力的接口取对应的形容词做接口名(通常是-able形式)
- [参考] 枚举类名建议带上Enum后缀, 枚举成员名称全部大写, 多个单词组成则用下划线隔开
- [参考] 各层命名约定
  - Service/Dao层方法命名
    - 获取单个对象方法用get做前缀, 后接Object核心名词; 例如: 对象ExportFlow, getFlow
    - 获取多个对象方法用getObjects做前缀; 例如: 对象ExportFlow, getFlows
    - 获取统计值方法用getCount做前缀;例如: getCount, getCountBy..., getCountOf...
    - 插入的方法用add/insert做前缀
    - 删除的方法用remove/delete做前缀
    - 修改的方法用update做前缀
  - `领域模型命名 (暂时领域模型未使用分层, 各层使用统一的bean)`

#### 1.2 常量定义
- [强制] 不允许任何魔法值直接出现在代码中
- [强制] Long或long初始赋值时, 使用大写的L, 不要写小写的l, 容易和1混淆
- [推荐] 不要使用一个常量类维护所有常量, 建议按照常量功能归类分开维护
- [推荐] 常量复用层可分五层
  - 跨应用共享常量: 放置在二方库中, 通常时client.jar, api.jar的constant目录下
  - `应用内共享常量`: 放置在一方库中, 通常是mudules的constant目录下
  - 子工程内部共享变量: 放在当前子工程的constant目录下
  - `包内共享变量`: 当前包下的constant目录下
  - 类内共享变量: 直接在类内部private static final定义
- [推荐] 如果一个变量值仅在一个范围内变化, 且带有名称之外的延伸属性, 定义为枚举类

#### 1.3 代码格式
- [强制] 大括号适用约定: 如果是大括号为空, 则大括号简写的写为 {} 即可, 不需要换行; 如果是非空代码块则:
  - 左大括号前不换行
  - 左大括号后换行
  - 右大括号前换行
  - 右大括号后还有 else 等代码则不换行, 表示终止的右大括号后必须换行
- [强制] 左小口号和字符间不出现空格; 同样, 右小括号和字符之间也不出现空格
- [强制] if/for/while/switch/do 等保留字与括号之间都必须加空格
- [强制] 任何二目, 三目运算符的左右两边都需要加一个空格
- [强制] 采用 4 个空格缩进, 禁止适用 tab 字符
- [强制] 注释的双斜线与 // 与注释内容之间有一个空格
- [强制] 单行字符数限制不超过 120 个, 超出需要换行, 换行时遵循以下原则
  - 第二行相对第一行缩进 4 个空格, 从第三行开始, 不再继续缩进
  - 运算符与上下文一起换行
  - 方法调用的点符号与下文一起换行
  - 方法调用时多个参数需要换行时在逗号后进行
  - 在括号前不要换行
- [强制] 方法参数在定义和传入时, 多个参数逗号后边必须加空格
- [强制] IDE 的 text file encoding 设置为 UTF-8, IDE 中文件的换行符使用 Unix 格式, 不要使用 Windows 格式
- [推荐] 没有必要增加若干空格来使某一行的字符与上一行对应位置的字符对齐
- 方法体内的执行语句组, 变量的定义语句组, 不同的业务逻辑之间或者不同的语义之间插入一个空行; 相同业务逻辑和语义之间不需要插入空行

#### 1.4 OOP规约
- [强制] 避免通过一个类的对象引用访问此类的静态变量或静态方法, 无谓增加编译器解析成本, 直接使用类名来访问即可
- [强制] 所有的复写方法必须加 @Override 注解
- [强制] 相同参数类型, 相同业务含义, 才可以使用 Java 的可变参数, 避免使用 Object
- [强制] 外部正在调用或者二方库依赖的接口, 不允许修改方法签名, 避免对接口调用方产生影响; 接口过时必须加 @Deprecated 注解, 并清晰的说明采用的新接口或者新服务是什么
- [强制] 不能使用过时的类或方法
- [强制] Object 的 equals 方法容易抛空指针异常, 应使用常量或者确定有值的对象来调用 equals
- [强制] 所有的相同类型的包装类对象之间的值的比较, 全部使用 equals 方法比较
- 关于基本类型数据与包装数据类型的使用标准如下
  - [强制] 所有的 POJO 类属性必须使用包装数据类型
  - [强制] RPC 方法的返回值和参数必须使用包装数据类型
  - [强制] 所有的局部变量使用基本数据类型
- [强制] 定义 DO/DTO/PTO/VO 等 POJO 类时, 不要设定任何属性默认值
- [强制] 序列化类新增属性时, 不要修改 serialVersionUID 字段, 避免反序列化失败; 如果完全不兼容升级, 避免反序列化混乱, 那么修改 serialVersionUID 值
- [强制] 构造方法里禁止加入任何业务逻辑, 如果有初始化逻辑放在 init 方法中
- [强制] POJO 类必须写 toString 方法, 使用 IDE 工具自动生成即可; 如果继承了另一个 POJO 类, 注意在前面加 super.toString
- [推荐] 使用索引访问 String 的 split 方法得到的数组时, 需做最后一个分隔符后有无内容的检查, 否则会抛 IndexOutOfBoundsException
- [推荐] 当一个类有多个构造方法, 或者多个同名方法, 这些方法应该按顺序放置在一起, 便于阅读
- [推荐] 类内方法定义顺序依次是: 公有方法或保护方法 > 私有方法 > getter/setter 方法
- [推荐] setter 方法中, 参数名称与类成员变量名称一致, this.成员名 = 参数名; 在 getter/setter 方法中不要增加业务逻辑, 会增加排查问题难度
- [推荐] 循环体内, 字符串的连接方式使用 StringBuilder 的 append 方法进行扩展
- [推荐] final 可以声明类, 成员变量, 方法, 以及本地变量, 以下情况使用 final 关键字
  - 不允许被继承的类
  - 不允许修改引用的域对象
  - 不允许被重写的方法
  - 不允许运行过程中重新赋值的局部变量
  - 避免上下文重复使用一个变量, 使用 final 描述可以强制重新定义一个变量, 方便更好的进行重构
- [推荐] 慎用 Object 的 clone 方法来拷贝对象
- [推荐] 类成员与方法访问控制从严
  - 如果不允许外部直接通过 new 来创建对象, 那么构造方法必须是 private
  - 工具类不允许有 public 或default 构造方法
  - 类非 static 成员变量并且与子类共享, 必须是 protected
  - 类非 static 成员变量并且仅在本类使用, 必须是 private
  - 类 static 成员变量如果仅在本类使用, 必须是 private
  - 若是 static 成员变量, 必须考虑是否谓 final
  - 类成员方法只供类内部调用, 必须是 private
  - 类成员方法只对继承类公开, 那么限制为 protected

### 插件使用
- Eclipse ([详细使用说明](https://github.com/alibaba/p3c/blob/master/eclipse-plugin/README_cn.md))  
安装: Help >> Install New Software >> 输入Update Site地址: https://p3c.alibaba.com/plugin/eclipse/update 回车, 然后勾选Ali-CodeAnalysis, 再一直点Next Next...按提示走下去就好, 然后就是提示重启了,安装完毕  
更新: 可以通过 Help >> Check for Udates 进行新版本检测  

>**参考:**  
[p3c](https://github.com/alibaba/p3c)
